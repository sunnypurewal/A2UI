{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://a2ui.org/specification/v0_10/server_to_client.json",
  "title": "A2UI Message Schema",
  "description": "Describes a JSON payload for an A2UI (Agent to UI) message, which is used to dynamically construct and update user interfaces.",
  "type": "object",
  "oneOf": [
    { "$ref": "#/$defs/CreateSurfaceMessage" },
    { "$ref": "#/$defs/UpdateComponentsMessage" },
    { "$ref": "#/$defs/UpdateDataModelMessage" },
    { "$ref": "#/$defs/DeleteSurfaceMessage" },
    { "$ref": "#/$defs/CallFunctionMessage" }
  ],
  "$defs": {
    "CreateSurfaceMessage": {
      "type": "object",
      "properties": {
        "version": {
          "const": "v0.10"
        },
        "createSurface": {
          "type": "object",
          "description": "Signals the client to create a new surface and begin rendering it. When this message is sent, the client will expect 'updateComponents' and/or 'updateDataModel' messages for the same surfaceId that define the component tree.",
          "properties": {
            "surfaceId": {
              "type": "string",
              "description": "The unique identifier for the UI surface to be rendered."
            },
            "catalogId": {
              "description": "A string that uniquely identifies this catalog. It is recommended to prefix this with an internet domain that you own, to avoid conflicts e.g. mycompany.com:somecatalog'.",
              "type": "string"
            },
            "theme": {
              "$ref": "catalog.json#/$defs/theme",
              "description": "Initial theme parameters for the surface (e.g., {'primaryColor': '#FF0000'}). These must validate against the 'theme' schema defined in the catalog."
            },
            "sendDataModel": {
              "type": "boolean",
              "description": "If true, the client will send the full data model of this surface in the metadata of every A2A message sent to the server that created the surface. Defaults to false."
            }
          },
          "required": ["surfaceId", "catalogId"],
          "additionalProperties": false
        }
      },
      "required": ["createSurface", "version"],
      "additionalProperties": false
    },
    "UpdateComponentsMessage": {
      "type": "object",
      "properties": {
        "version": {
          "const": "v0.10"
        },
        "updateComponents": {
          "type": "object",
          "description": "Updates a surface with a new set of components. This message can be sent multiple times to update the component tree of an existing surface. One of the components in one of the components lists MUST have an 'id' of 'root' to serve as the root of the component tree. The createSurface message MUST have been previously sent with the 'catalogId' that is in this message.",
          "properties": {
            "surfaceId": {
              "type": "string",
              "description": "The unique identifier for the UI surface to be updated."
            },
            "components": {
              "type": "array",
              "description": "A list containing all UI components for the surface.",
              "minItems": 1,
              "items": {
                "$ref": "catalog.json#/$defs/anyComponent"
              }
            }
          },
          "required": ["surfaceId", "components"],
          "additionalProperties": false
        }
      },
      "required": ["updateComponents", "version"],
      "additionalProperties": false
    },
    "UpdateDataModelMessage": {
      "type": "object",
      "properties": {
        "version": {
          "const": "v0.10"
        },
        "updateDataModel": {
          "type": "object",
          "description": "Updates the data model for an existing surface. This message can be sent multiple times to update the data model. The createSurface message MUST have been previously sent with the 'catalogId' that is in this message.",
          "properties": {
            "surfaceId": {
              "type": "string",
              "description": "The unique identifier for the UI surface this data model update applies to."
            },
            "path": {
              "type": "string",
              "description": "An optional path to a location within the data model (e.g., '/user/name'). If omitted, or set to '/', refers to the entire data model."
            },
            "value": {
              "description": "The data to be updated in the data model. If present, the value at 'path' is replaced (or created). If omitted, the key at 'path' is removed.",
              "additionalProperties": true
            }
          },
          "required": ["surfaceId"],
          "additionalProperties": false
        }
      },
      "required": ["updateDataModel", "version"],
      "additionalProperties": false
    },
    "DeleteSurfaceMessage": {
      "type": "object",
      "properties": {
        "version": {
          "const": "v0.10"
        },
        "deleteSurface": {
          "type": "object",
          "description": "Signals the client to delete the surface identified by 'surfaceId'. The createSurface message MUST have been previously sent with the 'catalogId' that is in this message.",
          "properties": {
            "surfaceId": {
              "type": "string",
              "description": "The unique identifier for the UI surface to be deleted."
            }
          },
          "required": ["surfaceId"],
          "additionalProperties": false
        }
      },
      "required": ["deleteSurface", "version"],
      "additionalProperties": false
    },
    "CallFunctionMessage": {
      "type": "object",
      "description": "A function invoked from the server.",
      "properties": {
        "version": {
          "const": "v0.10"
        },
        "functionCallId": {
          "$ref": "common_types.json#/$defs/CallId",
          "description": "Unique ID for the instance of this function call. MUST be copied verbatim into the functionResponse or error."
        },
        "wantResponse": {
          "type": "boolean",
          "default": false
        },
        "callFunction": {
          "allOf": [
            {
              "$ref": "common_types.json#/$defs/FunctionCall"
            },
            {
              "properties": {
                "callableFrom": {
                  "description": "Specifies where this function can be invoked from.",
                  "enum": [
                    "remoteOnly",
                    "clientOrRemote"
                  ]
                }
              }
            }
          ],
          "required": ["call", "returnType", "callableFrom"],
          "unevaluatedProperties": false
        }
      },
      "required": ["version", "callFunction", "functionCallId"],
      "additionalProperties": false
    }
  }
}
